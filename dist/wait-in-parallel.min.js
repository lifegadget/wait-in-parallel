!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=function(e,t,r,i){return new(r||(r=Promise))(function(s,n){function a(e){try{u(i.next(e))}catch(e){n(e)}}function o(e){try{u(i.throw(e))}catch(e){n(e)}}function u(e){e.done?s(e.value):new r(function(t){t(e.value)}).then(a,o)}u((i=i.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});var i=require("common-types"),s=require("./ParallelError"),n=require("./TimeoutError"),a=require("./ParallelError");function o(e){return"function"==typeof e}exports.ParallelError=a.ParallelError;var u=function(){function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throw:!0};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this.options=e,this._tasks=[],this._errors={},this._results={},this._successful=[],this._failed=[],this._registrations={},this._failFast=!1,this._failureCallbacks=[],this._successCallbacks=[],void 0===e.throw&&(e.throw=!0)}var u,l,c;return u=a,c=[{key:"create",value:function(){return new a}}],(l=[{key:"_get",value:function(e){if(!new Set(["failed","successful","errors","results","failFast","registrations","notifyOnFailure","notifyOnSuccess"]).has(e))throw new Error('"'.concat(e,'" is not a valid property to get.'));return this["_".concat(e)]}},{key:"add",value:function(e,t,r){try{this.register(e,t,{timeout:r})}catch(s){if("NameAlreadyExists"===s.name){if(o(t))throw s;var i=Math.random().toString(36).substr(2,10);console.error('wait-in-parallel: The promise just added as "'.concat(e,'" is a duplicate name to one already being managed but since the Promise is already executing we will give it a new name of "').concat(i,'" and continue to manage it!')),this.register(i,t,{timeout:r})}}return this}},{key:"clear",value:function(){return this._tasks=[],this._errors={},this._results={},this._successful=[],this._failed=[],this._registrations={},this._failureCallbacks=[],this._successCallbacks=[],this}},{key:"failFast",value:function(e){return this._failFast=void 0===e||e,this}},{key:"isDone",value:function(){return r(this,void 0,void 0,function*(){if(this.startDelayedTasks(),yield Promise.all(this._tasks),this._failed.length>0)throw new s.ParallelError(this);return this._results})}},{key:"isDoneAsArray",value:function(t){return r(this,void 0,void 0,function*(){var r=yield this.isDone(),i=[];return Object.keys(r).map(function(s){var n,a=r[s];i.push(t?Object.assign({},"object"===e(n=a)?n:{value:n},function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},t,s)):a)}),i})}},{key:"notifyOnFailure",value:function(e){return this._failureCallbacks.push(e),this}},{key:"notifyOnSuccess",value:function(e){return this._successCallbacks.push(e),this}},{key:"register",value:function(e,t,r){if(new Set(Object.keys(this._registrations)).has(e)){var i=new Error('There is already a registered item using the name "'.concat(e,'" in your Parallel object. Names must be unique, ignoring new addition.'));throw i.name="NameAlreadyExists",i}if(this._registrations[e]=r,o(t))this._registrations[e].deferred=t;else{r.timeout;this._tasks.push(this.promiseOnATimer(t,e))}}},{key:"_handleSuccess",value:function(e,t){this._successful.push(e),this._results[e]=t}},{key:"_handleFailure",value:function(e,t){if(this._failed.push(e),this._errors[e]=Object.assign({},t,{message:t.message,name:t.name,stack:t.stack}),this._failFast)throw new s.ParallelError(this)}},{key:"startDelayedTasks",value:function(){var e=this;Object.keys(this._registrations).map(function(t){var r=e._registrations[t];if(r.deferred)try{e._tasks.push(e.promiseOnATimer(r.deferred(),t))}catch(r){e._handleFailure(t,r)}})}},{key:"promiseOnATimer",value:function(e,t){var s,a,o=this,u=this._registrations[t],l=function(e){return o._handleSuccess(t,e)},c=function(e){return o._handleFailure(t,e)},f=u.timeout||0;try{return s=f>0?Promise.race([e,(a=f,r(o,void 0,void 0,function*(){throw yield i.wait(a),new n.default(u.deferred,a)}))]).then(l).catch(c):e.then(l).catch(c),this._tasks.push(s),s}catch(e){this._handleFailure(t,e)}}}])&&t(u.prototype,l),c&&t(u,c),a}();exports.default=u});
//# sourceMappingURL=wait-in-parallel.min.js.map
